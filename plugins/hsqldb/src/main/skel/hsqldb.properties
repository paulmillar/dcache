##
##  HSQLDB requires an orderly shutdown to guarantee committed data is
##  safe.  This is because the WRITE DELAY feature flushes an internal
##  buffer before calling fsync (despite what the HSQLDB documentat
##  says).  This, along with v1.2.8 HikariCP 'shutdown' method not
##  actually doing anything means that an application updating a
##  database within 500 ms before exiting risks data-loss.
##
##  While a NO-OP 'shutdown' method is broken, arguably the problem is
##  really exposing a bug in HSQLDB (in their documentation, if
##  nothing else).  This has been reported:
##
##      https://sourceforge.net/p/hsqldb/bugs/1338/
##
##  As a work-around, the WRITE DELAY feature is disabled via the
##  'hsqldb.write_delay=false' option.
##

hsqldb.path = ${dcache.home}/var/db

(immutable)billing.db.hsql.schema.changelog-when-true=org/dcache/hsqldb/changelog/billing-master.xml
(immutable)billing.db.hsql.schema.changelog-when-false=

billing.db.url=jdbc:hsqldb:file:${hsqldb.path}/${billing.db.name};shutdown=true;hsqldb.write_delay=false
billing.db.schema.changelog=${billing.db.hsql.schema.changelog-when-${billing.enable.db}}

chimera.db.url = jdbc:hsqldb:file:${hsqldb.path}/${chimera.db.name};shutdown=true;hsqldb.write_delay=false
chimera.db.dialect = HsqlDB

pinmanager.db.name = pinmanager
pinmanager.db.url = jdbc:hsqldb:file:${hsqldb.path}/${pinmanager.db.name};shutdown=true;hsqldb.write_delay=false
pinmanager.db.schema.changelog=org/dcache/hsqldb/changelog/pinmanager-master.xml

replica.db.url = jdbc:hsqldb:file:${hsqldb.path}/${replica.db.name};shutdown=true;hsqldb.write_delay=false
replica.db.schema.changelog=org/dcache/hsqldb/changelog/replica-master.xml

spacemanager.db.name = spacemanager
spacemanager.db.url = jdbc:hsqldb:file:${hsqldb.path}/${spacemanager.db.name};shutdown=true;hsqldb.write_delay=false

srm.db.name = srm
srm.db.url = jdbc:hsqldb:file:${hsqldb.path}/${srm.db.name};shutdown=true;hsqldb.write_delay=false

transfermanagers.db.name = transfermanagers
transfermanagers.db.url = jdbc:hsqldb:file:${hsqldb.path}/${transfermanagers.db.name};shutdown=true;hsqldb.write_delay=false

alarms.url-when-type-is-off =
alarms.url-when-type-is-xml = xml:file:${alarms.db.xml.path}
alarms.url-when-type-is-rdbms = jdbc:hsqldb:file:${hsqldb.path}/${alarms.db.name};shutdown=true;hsqldb.write_delay=false
alarms.db.url = ${alarms.url-when-type-is-${alarms.db.type}}
